while keep_running():
  // check if we need to setup or reset connection & register listener
  sleep(0.2) // make this short 

// disconnect